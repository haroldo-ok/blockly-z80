 <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Blockly-Z80 demo</title>

<style>
	html, body {
		background-color: #fff;
		margin: 0;
		padding: 0;
		overflow: hidden;
		height: 100%;
	}
	
	#blockly-editor {
		width: 100%;
		height: 100%;
	}

	#blockly-output {
		width: 100%;
		height: 70%;
	}
	
	#bitz80-output {
		width: 100%;
		height: 30%;
	}
	
	#blockly-editor {
		border: 1px solid #ddd;
	}
	
	#frame-container, #output-container {
		height: 100%;
	}
	
	#frame-container {
		width: 70%;
	}
	
	#output-container {
		position: absolute;
		top: 0;
		left: 70%;
		right: 0;
	}
	
	#bitz80-container {
		display: none;
	}
</style>

</head>

<body>
	<script>
		function blocklyLoaded(blockly) {		
			// Called once Blockly is fully loaded.
			console.debug('Blockly ready');			
            window.Blockly = blockly;
			checkLoaded();
		}
		
		function bitz80Loaded(BitZ80) {
			console.debug('BitZ80 ready');			
			window.BitZ80 = BitZ80;
			checkLoaded();
		}
		
		function checkLoaded() {
			if (window['Blockly'] && window['BitZ80']) {
				console.debug('Everything is ready');
				Blockly.addChangeListener(function(){
					var code = Blockly.Z80.workspaceToCode();
					document.getElementById('blockly-output').value = code;
					
					var bzOut = document.getElementById('bitz80-output');
					bzOut.value = '';
					
					var asm = new BitZ80.ASM();
					try {
						asm.start(code);
						asm.evaluateData();
						
						bzOut.value = 'OK';
					} catch (e) {
						bzOut.value = e;
					}
				});
			} else {
				// Still waiting for dependencies to load
			}			
		}
	</script>
	
	<div id="frame-container">
		<iframe id="blockly-editor" src="frame.html"></iframe>
	</div>
	<div id="output-container">
		<textarea id="blockly-output"></textarea>
		<textarea id="bitz80-output"></textarea>
	</div>
	
	<iframe id="bitz80-container" src="bitz80-frame.html"></iframe>
</body>

</html> 